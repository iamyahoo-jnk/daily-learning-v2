<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„œë²„ ë°ì´í„° êµ¬ì¡° ë””ë²„ê¹…</title>
    <style>
        body {
            font-family: 'Segoe UI', monospace;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        .section h2 {
            color: #333;
            margin-top: 0;
        }
        .result {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ì„œë²„ ë°ì´í„° êµ¬ì¡° ë””ë²„ê¹… ë„êµ¬</h1>
        
        <div class="section">
            <h2>1. ë¡œê·¸ì¸</h2>
            <div class="input-group">
                <label for="userId">í•™ìƒ ì•„ì´ë””:</label>
                <input type="text" id="userId" placeholder="í•™ìƒ ì•„ì´ë”” ì…ë ¥">
            </div>
            <div class="input-group">
                <label for="userPassword">ë¹„ë°€ë²ˆí˜¸:</label>
                <input type="password" id="userPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
            </div>
            <button onclick="loginAndDebug()">ë¡œê·¸ì¸ í›„ ë°ì´í„° ì¡°ì‚¬</button>
            <div class="result" id="loginResult">ë¡œê·¸ì¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>

        <div class="section">
            <h2>2. í• ë‹¹ëœ ê³¼ì œ ì¡°ì‚¬</h2>
            <button onclick="debugAssignments()">ì˜¤ëŠ˜ í• ë‹¹ëœ ê³¼ì œ ì¡°íšŒ</button>
            <div class="result" id="assignmentResult">ê³¼ì œ ì¡°íšŒ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>

        <div class="section">
            <h2>3. ì œì¶œ ë°ì´í„° êµ¬ì¡° ì¡°ì‚¬</h2>
            <button onclick="debugAllSubmissions()">ëª¨ë“  ì œì¶œ ë°ì´í„° ì¡°ì‚¬</button>
            <div class="result" id="submissionResult">ì œì¶œ ë°ì´í„° êµ¬ì¡°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>

        <div class="section">
            <h2>4. íŠ¹ì • ê³¼ì œ ID ì œì¶œ ìƒíƒœ í™•ì¸</h2>
            <div class="input-group">
                <label for="taskIdToCheck">í™•ì¸í•  ê³¼ì œ ID:</label>
                <input type="text" id="taskIdToCheck" placeholder="ì˜ˆ: task_20250912_001">
            </div>
            <button onclick="debugSpecificTask()">íŠ¹ì • ê³¼ì œ ì œì¶œ ìƒíƒœ í™•ì¸</button>
            <div class="result" id="specificTaskResult">íŠ¹ì • ê³¼ì œ í™•ì¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
    </div>

    <script type="module">
        import { authManager } from './core/auth.js';
        import { dbManager } from './core/database.js';
        import { utils } from './config/app-config.js';

        let currentUser = null;

        window.loginAndDebug = async function() {
            const loginResult = document.getElementById('loginResult');
            const userId = document.getElementById('userId').value.trim();
            const password = document.getElementById('userPassword').value.trim();
            
            if (!userId || !password) {
                loginResult.textContent = 'âŒ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                return;
            }
            
            try {
                loginResult.textContent = 'ğŸ” ë¡œê·¸ì¸ ì‹œë„ ì¤‘...';
                
                const loginResponse = await authManager.login(userId, password);
                
                if (loginResponse.success) {
                    currentUser = loginResponse.user;
                    
                    const result = `âœ… ë¡œê·¸ì¸ ì„±ê³µ!
ğŸ‘¤ ì‚¬ìš©ì ì •ë³´:
  - UID: ${currentUser.uid}
  - ì´ë©”ì¼: ${currentUser.email}
  - í‘œì‹œëª…: ${currentUser.displayName}
  - ì—­í• : ${authManager.isStudent(currentUser) ? 'í•™ìƒ' : 'ë¹„í•™ìƒ'}
  - UID ê¸¸ì´: ${currentUser.uid.length}ì

ğŸŒ Firebase ì—°ê²° ìƒíƒœ: ì •ìƒ
ğŸ“… ì˜¤ëŠ˜ ë‚ ì§œ í‚¤: ${utils.getTodayKey()}`;
                    
                    loginResult.textContent = result;
                    
                    // ìë™ìœ¼ë¡œ ë‹¤ë¥¸ ë””ë²„ê¹…ë„ ì‹¤í–‰
                    setTimeout(() => {
                        debugAssignments();
                        debugAllSubmissions();
                    }, 1000);
                    
                } else {
                    loginResult.textContent = `âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ${loginResponse.error}`;
                }
                
            } catch (error) {
                loginResult.textContent = `âŒ ë¡œê·¸ì¸ ì˜¤ë¥˜: ${error.message}\nìŠ¤íƒ: ${error.stack}`;
            }
        };

        window.debugAssignments = async function() {
            const assignmentResult = document.getElementById('assignmentResult');
            
            if (!currentUser) {
                assignmentResult.textContent = 'âŒ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.';
                return;
            }
            
            try {
                assignmentResult.textContent = 'ğŸ“š í• ë‹¹ëœ ê³¼ì œ ì¡°íšŒ ì¤‘...';
                
                const todayKey = utils.getTodayKey();
                const assignmentResponse = await dbManager.getAssignment(currentUser.uid, todayKey);
                
                let result = `ğŸ“… ì¡°íšŒ ë‚ ì§œ: ${todayKey}\n`;
                result += `ğŸ‘¤ ì‚¬ìš©ì UID: ${currentUser.uid}\n\n`;
                
                if (assignmentResponse.success) {
                    result += `âœ… í• ë‹¹ëœ ê³¼ì œ ë°œê²¬!\n`;
                    result += `ğŸ“Š ê³¼ì œ ë°ì´í„°:\n${JSON.stringify(assignmentResponse.data, null, 2)}`;
                    
                    if (assignmentResponse.data.tasks) {
                        result += `\n\nğŸ“‹ ê³¼ì œ ëª©ë¡ (${Array.isArray(assignmentResponse.data.tasks) ? assignmentResponse.data.tasks.length : Object.keys(assignmentResponse.data.tasks).length}ê°œ):`;
                        
                        const tasks = Array.isArray(assignmentResponse.data.tasks) ? assignmentResponse.data.tasks : Object.values(assignmentResponse.data.tasks);
                        tasks.forEach((task, index) => {
                            result += `\n  ${index + 1}. íƒ€ì…: ${task.type}, ID: ${task.taskId || 'ì—†ìŒ'}, ì•„ì´í…œ: ${task.items}`;
                        });
                    }
                } else {
                    result += `âŒ í• ë‹¹ëœ ê³¼ì œ ì—†ìŒ\nì˜¤ë¥˜: ${assignmentResponse.error || assignmentResponse.message}`;
                }
                
                assignmentResult.textContent = result;
                
            } catch (error) {
                assignmentResult.textContent = `âŒ ê³¼ì œ ì¡°íšŒ ì˜¤ë¥˜: ${error.message}\nìŠ¤íƒ: ${error.stack}`;
            }
        };

        window.debugAllSubmissions = async function() {
            const submissionResult = document.getElementById('submissionResult');
            
            if (!currentUser) {
                submissionResult.textContent = 'âŒ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.';
                return;
            }
            
            try {
                submissionResult.textContent = 'ğŸ“Š ëª¨ë“  ì œì¶œ ë°ì´í„° ì¡°ì‚¬ ì¤‘...';
                
                const submissionResponse = await dbManager.getAllSubmissionsByUser(currentUser.uid);
                
                let result = `ğŸ‘¤ ì‚¬ìš©ì UID: ${currentUser.uid}\n`;
                result += `ğŸ“Š ì œì¶œ ë°ì´í„° ì¡°íšŒ ê²°ê³¼:\n\n`;
                
                if (submissionResponse.success && submissionResponse.data.length > 0) {
                    result += `âœ… ${submissionResponse.data.length}ê°œì˜ ì œì¶œ ë¬¸ì„œ ë°œê²¬!\n\n`;
                    
                    submissionResponse.data.forEach((submission, index) => {
                        result += `ğŸ“„ ë¬¸ì„œ ${index + 1} (ID: ${submission.documentId}):\n`;
                        result += `${JSON.stringify(submission, null, 2)}\n\n`;
                    });
                    
                } else {
                    result += `âŒ ì œì¶œ ë°ì´í„° ì—†ìŒ\n`;
                    result += `ì‘ë‹µ: ${JSON.stringify(submissionResponse, null, 2)}`;
                }
                
                submissionResult.textContent = result;
                
            } catch (error) {
                submissionResult.textContent = `âŒ ì œì¶œ ë°ì´í„° ì¡°ì‚¬ ì˜¤ë¥˜: ${error.message}\nìŠ¤íƒ: ${error.stack}`;
            }
        };

        window.debugSpecificTask = async function() {
            const specificTaskResult = document.getElementById('specificTaskResult');
            const taskId = document.getElementById('taskIdToCheck').value.trim();
            
            if (!currentUser) {
                specificTaskResult.textContent = 'âŒ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.';
                return;
            }
            
            if (!taskId) {
                specificTaskResult.textContent = 'âŒ í™•ì¸í•  ê³¼ì œ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                return;
            }
            
            try {
                specificTaskResult.textContent = `ğŸ” ê³¼ì œ ${taskId} ì œì¶œ ìƒíƒœ í™•ì¸ ì¤‘...`;
                
                const submissionResponse = await dbManager.getSubmissionByTaskId(currentUser.uid, taskId);
                
                let result = `ğŸ¯ ê³¼ì œ ID: ${taskId}\n`;
                result += `ğŸ‘¤ ì‚¬ìš©ì UID: ${currentUser.uid}\n`;
                result += `ğŸ“Š ì¡°íšŒ ê²°ê³¼:\n\n`;
                
                if (submissionResponse.success) {
                    if (submissionResponse.data) {
                        result += `âœ… ì œì¶œ ë°ì´í„° ë°œê²¬!\n`;
                        result += `ğŸ“„ ì œì¶œ ë°ì´í„°:\n${JSON.stringify(submissionResponse.data, null, 2)}`;
                    } else {
                        result += `ğŸ“ ì œì¶œ ë°ì´í„° ì—†ìŒ (ë¯¸ì™„ë£Œ ìƒíƒœ)`;
                    }
                } else {
                    result += `âŒ ì¡°íšŒ ì‹¤íŒ¨\nì˜¤ë¥˜: ${submissionResponse.error}`;
                }
                
                specificTaskResult.textContent = result;
                
            } catch (error) {
                specificTaskResult.textContent = `âŒ íŠ¹ì • ê³¼ì œ í™•ì¸ ì˜¤ë¥˜: ${error.message}\nìŠ¤íƒ: ${error.stack}`;
            }
        };
    </script>
</body>
</html>